function showErrorAlert(e){var a=$("#alert-error-div"),t=$("#alert-error-div > .alert.alert-danger");t.text(e),a.slideDown().addClass("is-visible")}function showPageLoader(){$pageLoaderModal.modal({backdrop:"static",keyboard:!1,show:!0}),$(".progress-bar").css("width","100%")}function authenticateUser(){request&&request.abort();var e={};e.role=sessionStorage.getItem("role"),e.username=sessionStorage.getItem("username"),e.uid=sessionStorage.getItem("uid"),"admin"==e.role,e.uid.indexOf("AD")>=0&&(request=$.ajax({url:"../php/adminValidator.php",type:"post",data:e}),request.done(accessValidSuccess),request.fail(accessValidError))}function checkAdminDetails(e){var a=0;return sessionStorage.getItem("username")!=e.user.username?a++:sessionStorage.getItem("role")!=e.user.role?a++:sessionStorage.getItem("uid")!=e.user.uid&&a++,0==a}function accessValidSuccess(e,a,t){return"object"!=typeof e?void showErrorAlert("Seems Like an error on server end, Please Contact Developer"):e.error?void showErrorAlert(e.message):void(checkAdminDetails(e)&&setupCrmPage(e,function(){$pageLoaderModal.modal("hide")}))}function accessValidError(e,a,t){showErrorAlert("Please Check Your Internet Connection")}function setupTable(e,a,t){var r=$("#info-body-row"),s=$("#transaction-body");if("object"!=typeof e)return r.html("<div class='col-md-12'><div class='alert alert-danger'>"+e.message+"</div>"),void r.modal("show");if(e.error)return r.html("<div class='col-md-12'><div class='alert alert-danger'>"+e.message+"</div>"),void r.modal("show");for(var o="",i=0;i<e.transactions.length;i++)o+="<tr><td>"+e.transactions[i].created_at+"</td><td data-uid="+e.transactions[i].uid+">"+e.transactions[i].uid+"</td><td>"+e.transactions[i].card_cust_name+"</td><td>"+e.transactions[i].amount+"</td><td>"+e.transactions[i].user+"</td><td>"+e.transactions[i].source+"</td></tr>";s.html(o)}function setupTableError(e,a,t){var r=$("#info-body-row");r.html("<div class='col-md-12'><div class='alert alert-danger'>"+response.message+"</div>")}function setupCrmPage(e,a){var t=$("a#username"),r=$("a#uid"),s=$("a#role");t.text(e.user.username),r.text(e.user.uid),s.text(e.user.role),request=$.ajax({url:"../php/getTransactions.php",type:"get"}),request.done(setupTable),request.fail(setupTableError),a()}function checkForUsage(){var e=($("#infoModal"),$("#formModal")),a=$("#search-btn"),t=$("#formModal-form");a.click(function(){e.modal("show")}),$("#formModalSelect").change(function(){"UID"==this.value?($("#transaction-term").slideDown().addClass("is-visible"),$("#card-number").hide(),$("#date").hide()):"CARD"==this.value?($("#card-number").slideDown().addClass("is-visible"),$("#transaction-term").hide(),$("#date").hide()):"DAY"==this.value?($("#date").slideDown().addClass("is-visible"),$("#dateInput").datepicker({changeMonth:!0,changeYear:!0,yearRange:"1900:2017",dateFormat:"yy/mm/dd"}),$("#card-number").hide(),$("#transaction-term").hide()):$("#transaction-term").slideDown().addClass("is-visible")}),t.submit(function(e){e.preventDefault(),$data=t.serialize();var a=t.find("input, select, button, textarea");a.prop("disabled",!0),request&&request.abort(),request=$.ajax({url:"../php/searchTransaction.php",type:"post",data:$data}),request.done(setupSearchTable),request.fail(setupSearchTableError)})}function setupSearchTable(e,a,t){var r=$("#info-body-row"),s=($("#transaction-body"),$("#infoModal")),o=$("#infoModalTitle"),i=$("#formModal"),n=$("#formModal-form"),d=n.find("input, select, button, textarea");if(d.prop("disabled",!1),i.modal("hide"),"object"!=typeof e)return r.html("<div class='col-md-12'><div class='alert alert-danger'>"+e.message+"</div>"),void s.modal("show");if(e.error)return r.html("<div class='col-md-12'><div class='alert alert-danger'>"+e.message+"</div>"),void s.modal("show");o.text("Search Results");for(var l="",c=0;c<e.transactions.length;c++)l+="<div class='col-md-12' style='padding: 20px; border-bottom: 1px dotted black;'><h3>Transaction #"+c+"</h3><p>Transaction ID: "+e.transactions[c].uid+"</p><p>Source: "+e.transactions[c].source+"</p><p>User: "+e.transactions[c].user+"</p><p>Card Type: "+e.transactions[c].card_type+"</p><p>Card Number: "+e.transactions[c].card_number+"</p><p>Card CVV: "+e.transactions[c].card_cvv_number+"</p><p>Card Expiry Date: "+e.transactions[c].card_expiry_date+"</p><p>Amount Charged: "+e.transactions[c].amount+"</p><p>Name on Card: "+e.transactions[c].card_cust_name+"</p><p>Billing Name: "+e.transactions[c].billing_name+"</p><p>Billing Email: "+e.transactions[c].billing_email+"</p><p>Billing Phone: "+e.transactions[c].billing_phone+"</p><p>Date Of Birth: "+e.transactions[c].billing_dob+"</p><p>Billing Company: "+e.transactions[c].billing_company+"</p><p>Billing Address: "+e.transactions[c].billing_address+"</p><p>Billing City: "+e.transactions[c].billing_city+"</p><p>Billing State: "+e.transactions[c].billing_state+"</p><p>Billing Country: "+e.transactions[c].billing_country+"</p><p>Billing Postal Code: "+e.transactions[c].billing_postal_code+"</p><p>Charged At: "+e.transactions[c].created_at+"</p></div>";r.html(l),s.modal("show")}function setupSearchTableError(e,a,t){$infoModalBody.html("<div class='col-md-12'><div class='alert alert-danger'>"+t.message+"</div>"),$infoModal.modal("show")}var request,$pageLoaderModal=$("#pageLoaderModal");$(function(){showPageLoader(),checkForUsage(),authenticateUser()});