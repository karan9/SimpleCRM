function showErrorAlert(e){var a=$("#alert-error-div"),t=$("#alert-error-div > .alert.alert-danger");t.text(e),a.slideDown().addClass("is-visible")}function showPageLoader(){$pageLoaderModal.modal({backdrop:"static",keyboard:!1,show:!0}),$(".progress-bar").css("width","100%")}function authenticateUser(){request&&request.abort();var e={};e.role=sessionStorage.getItem("role"),e.username=sessionStorage.getItem("username"),e.uid=sessionStorage.getItem("uid"),"admin"==e.role,e.uid.indexOf("AD")>=0&&(request=$.ajax({url:"../php/adminValidator.php",type:"post",data:e}),request.done(accessValidSuccess),request.fail(accessValidError))}function checkAdminDetails(e){var a=0;return sessionStorage.getItem("username")!=e.user.username?a++:sessionStorage.getItem("role")!=e.user.role?a++:sessionStorage.getItem("uid")!=e.user.uid&&a++,0==a}function accessValidSuccess(e,a,t){return"object"!=typeof e?void showErrorAlert("Seems Like an error on server end, Please Contact Developer"):e.error?void showErrorAlert(e.message):void(checkAdminDetails(e)&&setupCrmPage(e,function(){$pageLoaderModal.modal("hide")}))}function accessValidError(e,a,t){showErrorAlert("Please Check Your Internet Connection")}function setupTable(e,a,t){var r=$("#info-body-row"),s=$("#transaction-body");if("object"!=typeof e)return r.html("<div class='col-md-12'><div class='alert alert-danger'>"+e.message+"</div>"),void r.modal("show");if(e.error)return r.html("<div class='col-md-12'><div class='alert alert-danger'>"+e.message+"</div>"),void r.modal("show");for(var o="",n=0;n<e.transactions.length;n++)o+="<tr><td>"+e.transactions[n].created_at+"</td><td data-uid="+e.transactions[n].uid+">"+e.transactions[n].uid+"</td><td>"+e.transactions[n].card_cust_name+"</td><td>"+e.transactions[n].amount+"</td><td>"+e.transactions[n].user+"</td><td>"+e.transactions[n].source+"</td></tr>";s.html(o)}function setupTableError(e,a,t){var r=$("#info-body-row");r.html("<div class='col-md-12'><div class='alert alert-danger'>"+response.message+"</div>")}function setupCrmPage(e,a){var t=$("a#username"),r=$("a#uid"),s=$("a#role");t.text(e.user.username),r.text(e.user.uid),s.text(e.user.role),request=$.ajax({url:"../php/getTransactions.php",type:"get"}),request.done(setupTable),request.fail(setupTableError),a()}function checkForUsage(){var e=($("#infoModal"),$("#formModal")),a=($("#officeUserModal"),$("#search-btn")),t=$("#create-user-office-btn"),r=$("#formModal-form"),s=$("#officeUserModal-form");a.click(function(){e.modal("show")}),t.click(function(){t.modal("show")}),$("#formModalSelect").change(function(){"UID"==this.value?($("#transaction-term").slideDown().addClass("is-visible"),$("#card-number").hide(),$("#date").hide()):"CARD"==this.value?($("#card-number").slideDown().addClass("is-visible"),$("#transaction-term").hide(),$("#date").hide()):"DAY"==this.value?($("#date").slideDown().addClass("is-visible"),$("#dateInput").datepicker({changeMonth:!0,changeYear:!0,yearRange:"1900:2017",dateFormat:"yy/mm/dd"}),$("#card-number").hide(),$("#transaction-term").hide()):$("#transaction-term").slideDown().addClass("is-visible")}),r.submit(function(e){e.preventDefault(),$data=r.serialize(),request&&request.abort(),request=$.ajax({url:"../php/searchTransaction.php",type:"post",data:$data}),request.done(setupSearchTable),request.fail(setupSearchTableError)}),s.submit(function(e){e.preventDefault(),$data=s.serialize(),request&&request.abort(),request=$.ajax({url:"../php/createNewOfficeUser.php",type:"post",data:$data}),request.done(successfullNewUser),request.fail(errorNewUser)})}function setupSearchTable(e,a,t){var r=$("#info-body-row"),s=($("#transaction-body"),$("#infoModal")),o=$("#infoModalTitle"),n=$("#formModal");if($("#formModal-form"),n.modal("hide"),r.html(""),"object"!=typeof e)return console.log(e),r.html("<div class='col-md-12'><div class='alert alert-danger'>Response is not a object</div>"),void s.modal("show");if(e.error)return r.html("<div class='col-md-12'><div class='alert alert-danger'>"+e.message+"</div>"),void s.modal("show");o.text("Search Results");for(var i="",d=0;d<e.transactions.length;d++)i+="<div class='col-md-12' style='padding: 20px; border-bottom: 1px dotted black;'><h3>Transaction #"+d+"</h3><p><strong>Transaction ID: </strong>"+e.transactions[d].uid+"</p><p><strong>Source: </strong>"+e.transactions[d].source+"</p><p><strong>User: </strong>"+e.transactions[d].user+"</p><p><strong>Card Type: </strong>"+e.transactions[d].card_type+"</p><p><strong>Card Number: </strong>"+e.transactions[d].card_number+"</p><p><strong>Card CVV: </strong>"+e.transactions[d].card_cvv_number+"</p><p><strong>Card Expiry Date: </strong>"+e.transactions[d].card_expiry_date+"</p><p><strong>Amount Charged: </strong>"+e.transactions[d].amount+"</p><p><strong>Name on Card: </strong>"+e.transactions[d].card_cust_name+"</p><p><strong>Billing Name: </strong>"+e.transactions[d].billing_name+"</p><p><strong>Billing Email: </strong>"+e.transactions[d].billing_email+"</p><p><strong>Billing Phone: </strong>"+e.transactions[d].billing_phone+"</p><p><strong>Date Of Birth: </strong>"+e.transactions[d].billing_dob+"</p><p><strong>Billing Company: </strong>"+e.transactions[d].billing_company+"</p><p><strong>Billing Address: </strong>"+e.transactions[d].billing_address+"</p><p><strong>Billing City: </strong>"+e.transactions[d].billing_city+"</p><p><strong>Billing State: </strong>"+e.transactions[d].billing_state+"</p><p><strong>Billing Country: </strong>"+e.transactions[d].billing_country+"</p><p><strong>Billing Postal Code: </strong>"+e.transactions[d].billing_postal_code+"</p><p><strong>Charged At: </strong>"+e.transactions[d].created_at+"</p></div>";r.html(i),s.modal("show"),console.log(e),s.on("hide.bs.modal",function(){window.location.reload()})}function setupSearchTableError(e,a,t){$infoModalBody.html("<div class='col-md-12'><div class='alert alert-danger'>"+t.message+"</div>"),$infoModal.modal("show")}function successfullNewUser(e,a,t){var r=$("#info-body-row"),s=$("#infoModal"),o=($("#infoModalTitle"),$("#officeUserModal"));return o.modal("hide"),r.html(""),"object"!=typeof e?(console.log(e),r.html("<div class='col-md-12'><div class='alert alert-danger'>Response is not a object</div>"),void s.modal("show")):e.error?(r.html("<div class='col-md-12'><div class='alert alert-danger'>"+e.message+"</div>"),void s.modal("show")):(r.html("<div class='col-md-12'><div class='alert alert-success'>"+e.message+"</div>"),s.modal("show"),console.log(e),void s.on("hide.bs.modal",function(){window.location.reload()}))}function errorNewUser(e,a,t){$infoModalBody.html("<div class='col-md-12'><div class='alert alert-danger'>"+t+"</div>"),$infoModal.modal("show")}var request,$pageLoaderModal=$("#pageLoaderModal");$(function(){showPageLoader(),checkForUsage(),authenticateUser()});